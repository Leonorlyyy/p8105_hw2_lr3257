---
title: "p8105_hw2_lr3257"
author: "Leonor Rui"
date: "2024-09-30"
output: github_document
---

```{r setup, echo=FALSE, message=FALSE}
library(tidyverse)
library(readxl)
library(dplyr)
```

# Homework 2

## Problem 1

```{r}
### read data file
NYC_df = 
  read_csv("data/NYCsubway.csv",  na = c("NA", "", "."), show_col_types = FALSE) |>
  janitor::clean_names() |>
  mutate(
    entry = ifelse(entry == "YES", TRUE, FALSE)
    )

```

### Description:

There are 32 variables contained in this dataset: division (character), line (character), station_name (character), station_latitude (double), station_longtitude (double), route 1-7 (character), route 8-11 (double), entrance_type (character), entry (character), exit_only (character), vending (character), staffing (character), staff_hours (character), ada (logical), ada_notes (character), free_crossover (logical), north_south_street (character), east_west_street (character), corner (character), entrance_latitude (double), entrance_longitude (double), station_location (character), entrance_location (character). 

So far, I have used the janitor::clean_names() function for some basic cleanings about the column names, including converting all column names to lowercase, replacing spaces and special characters with underscores, etc. I have also defined the "NA", ",", and "." values in the dataset to be na for the convenience of later data analysis. 

The dimension of the dataset now is 1868 rows x 32 columns. Despite I have changed the entry variable from character to logical type, the dataset is still not tidy, as there are many more character variables that could be turned into logical variables, and there are many NA data in it that may interfere further data analysis. 

- How many distinct stations are there?

```{r}
distinct(NYC_df, line, station_name)
```

There are 465 distinct stations. 

- How many stations are ADA compliant?
```{r}
filter(NYC_df, ada == TRUE) |>
  distinct(line, station_name)
```

84 stations are ADA compliant. 

- What proportion of station entrances / exits without vending allow entrance?

```{r}
vending_df = filter(NYC_df, vending == "NO")
vending_entry_df = filter(vending_df, entry == "TRUE")
nrow(vending_entry_df)/nrow(vending_df)
```

About 37.7% of stations without vending allow entrance.

- Reformat data so that route number and route name are distinct variables. How many distinct stations serve the A train? Of the stations that serve the A train, how many are ADA compliant?

```{r}
NYC_df = mutate(
    NYC_df,
    route8 = as.character(route8),
    route9 = as.character(route9),
    route10 = as.character(route10),
    route11 = as.character(route11)
  ) |>
  pivot_longer(
  cols = route1:route11,
  names_to = "route_number",
  values_to = "route_name",
  names_prefix = "route") |>
  drop_na(route_name)
print(NYC_df)
```


```{r}
A_df = filter(NYC_df, route_name == "A")
A_ada_df = filter(A_df, ada == "TRUE")
A_distinct = distinct(A_df, line, station_name)
A_ada_distinct = distinct(A_ada_df, line, station_name)
```

`r nrow(A_distinct)` distinct stations serve the A train. Out of these stations, `r nrow(A_ada_distinct)` stations are ADA compliant.

## Problem 2

### Mr. Trash Wheel sheet

```{r}
Mr_TW = read_excel("data/Trash_wheel.xlsx", sheet = "Mr. Trash Wheel") |>
  janitor::clean_names() |>
  mutate(
    sports_balls = as.integer(round(sports_balls)),
    year = as.numeric(year)
  ) |>
  select(-(x15:x16)) |>
  slice(1:(n()-1))
print(Mr_TW)
```

### Professor Trash Wheel

```{r}
Prof_TW = read_excel("data/Trash_wheel.xlsx", sheet = "Professor Trash Wheel")|>
  janitor::clean_names() |>
  slice(1:(n()-1))
print(Prof_TW)
```

### Gwynnda 

```{r}
G_TW = read_excel("data/Trash_wheel.xlsx", sheet = "Gwynnda Trash Wheel") |>
  janitor::clean_names() |>
  slice(1:(n()-2))
print(G_TW)
```

### Combine datasets

```{r}
Mr_TW = mutate(Mr_TW, trash_wheel = "Mr. Trash Wheel") |>
  relocate (trash_wheel)

Prof_TW = Prof_TW |>
  add_column(sports_balls = NA, .before = 13)|>
  mutate(
    trash_wheel = "Professor Trash Wheel"
  ) |>
  relocate(trash_wheel)

G_TW = G_TW |>
  add_column(sports_balls = NA, .before = 12) |>
  add_column(glass_bottles = NA, .after = 9) |>
  mutate(
    trash_wheel = "Gwynnda Trash Wheel"
  ) |>
  relocate(trash_wheel)

combined_TW = bind_rows(Mr_TW, Prof_TW, G_TW)
print(combined_TW)
```

### Description:

There are `r ncol(combined_TW)` variables and `r nrow(combined_TW)` observations in this final combined dataset. Important variables include weight_tons (double, weight of trash the wheel collected in tons), volume_cubic_yars (numeric, volume of trash collected in cubic yards), homes_powered (double, number of homes powered by energy generated by the trash), and some variables dedicated to the number of a certain kind of trash the wheel collected (e.g. plastic_bottles, wrappers). It's noteworthy that only Mr. Trash Wheel has the "sports_balls" variable and Gwynnda Trash Wheel does not have the "glass_bottles" variable, meaning we need to create a new and empty variable for Professor Trash Wheel and two such variables for Gwynnda Trash Wheel.
 
The total weight of trash collected by Professor Trash Wheel is `r sum(select(Prof_TW, weight_tons))` tons. 

```{r}
filter(G_TW, month == "June", year == 2022) |>
  select(cigarette_butts) |>
  sum()
```

The total number of cigarette butts collected by Gwynnda in June of 2022 is 18120.















